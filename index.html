<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR4UPLOAD - Upload & Share</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#0f172a',
                        card: '#1e293b',
                        accent: '#6366f1',
                        accentHover: '#4f46e5'
                    },
                    animation: {
                        'bounce-slow': 'bounce 3s infinite',
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; }
        
        .upload-box {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%236366F1FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
            transition: all 0.3s ease;
        }
        .upload-box:hover, .upload-box.dragover {
            background-color: rgba(99, 102, 241, 0.12);
            transform: scale(1.015);
            cursor: pointer;
        }
        .uploading {
            cursor: wait !important;
            opacity: 0.75;
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden">

    <!-- Background blur -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-10 left-10 w-72 h-72 bg-accent/20 rounded-full blur-[100px]"></div>
        <div class="absolute bottom-10 right-10 w-96 h-96 bg-purple-600/20 rounded-full blur-[100px]"></div>
    </div>

    <div class="w-full max-w-md bg-card/80 backdrop-blur-md p-6 sm:p-8 rounded-3xl shadow-2xl border border-slate-700/50">
        
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-2xl font-black tracking-tighter text-white mb-1">
                AR4<span class="text-accent">UPLOAD</span>
            </h1>
            <p class="text-slate-400 text-xs">Simpel. Cepat. Tanpa ribet login.</p>
        </div>

        <!-- Config Warning -->
        <div id="config-warning" class="hidden mb-5 p-4 bg-red-500/10 border border-red-500/40 rounded-xl flex items-start gap-3 text-sm">
            <i class="fas fa-exclamation-triangle text-red-400 mt-1 text-xl"></i>
            <div class="text-red-200">
                <strong>Config belum diisi!</strong><br>
                Buka file ini, isi <code>SUPABASE_URL</code> & <code>SUPABASE_KEY</code> di bagian paling bawah script.
            </div>
        </div>

        <!-- VIEW 1: UPLOAD -->
        <div id="view-upload" class="transition-all duration-300">
            <label for="file-input" id="drop-zone" class="upload-box w-full h-60 rounded-2xl flex flex-col items-center justify-center group relative">
                <div class="bg-slate-800/80 p-5 rounded-full mb-4 group-hover:bg-slate-700 transition-colors">
                    <i class="fas fa-cloud-arrow-up text-4xl text-accent animate-bounce-slow"></i>
                </div>
                <h3 class="text-white font-bold text-xl">Drop atau Klik disini</h3>
                <p class="text-slate-400 text-sm mt-2">File apa aja, max 50MB</p>
                <input type="file" id="file-input" class="hidden">
            </label>
        </div>

        <!-- VIEW 2: PROGRESS -->
        <div id="view-progress" class="hidden flex flex-col items-center py-6">
            <div class="w-full bg-slate-800/60 p-5 rounded-xl border border-slate-700 mb-6 flex items-center gap-4">
                <div class="bg-accent/20 p-4 rounded-xl text-accent">
                    <i class="fas fa-file-alt text-2xl"></i>
                </div>
                <div class="flex-1 min-w-0">
                    <p id="file-name" class="text-base font-medium text-white truncate">nama_file.zip</p>
                    <p id="file-size" class="text-sm text-slate-400 mt-1">0 MB</p>
                </div>
            </div>

            <div class="w-full space-y-3">
                <div class="flex justify-between text-sm text-slate-300">
                    <span id="status-text">Sedang mengunggah...</span>
                    <span id="progress-percent">0%</span>
                </div>
                <div class="w-full bg-slate-700 h-3 rounded-full overflow-hidden shadow-inner">
                    <div id="progress-bar" class="h-full bg-gradient-to-r from-accent to-purple-600 w-0 transition-all duration-200 ease-out"></div>
                </div>
            </div>
        </div>

        <!-- VIEW 3: RESULT -->
        <div id="view-result" class="hidden pt-4">
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-green-500/15 rounded-full mb-4 text-green-400 border border-green-500/30">
                    <i class="fas fa-check text-3xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-white">Selesai!</h3>
                <p class="text-slate-400 mt-2">File kamu sudah bisa dibagi</p>
            </div>

            <div class="bg-slate-900 p-2 rounded-xl border border-slate-700 flex items-center">
                <input type="text" id="result-link" readonly 
                    class="bg-transparent w-full px-3 py-2 text-sm text-slate-200 focus:outline-none"
                    placeholder="Link akan muncul disini...">
                <button onclick="copyToClipboard()" class="bg-accent hover:bg-accentHover text-white px-5 py-2.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 whitespace-nowrap">
                    <i class="fas fa-copy"></i> Copy
                </button>
            </div>

            <button onclick="resetApp()" class="w-full mt-6 py-3 text-slate-400 hover:text-white transition-colors text-sm border-t border-slate-800 pt-5">
                <i class="fas fa-redo mr-2"></i> Upload file lain
            </button>
        </div>

    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-3.5 rounded-2xl shadow-2xl border border-slate-700 flex items-center gap-3 transform -translate-y-24 opacity-0 transition-all duration-300 z-50">
        <i id="toast-icon" class="fas fa-info-circle text-xl"></i>
        <span id="toast-msg" class="text-sm font-medium">Notif</span>
    </div>

    <script>
        // ==========================================
        // CONFIG - WAJIB DIISI DULUAN
        // ==========================================
        const SUPABASE_URL = 'https://owivtazpjnkbncfwmitk.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im93aXZ0YXpwam5rYm5jZndtaXRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3MTc2MjUsImV4cCI6MjA4NDI5MzYyNX0.nCz4yDlg-iPOZfHrrQHU5tvlDTZJ2HpXWJMGXVPYVsI'; 
        const BUCKET_NAME = 'media'; // ganti kalau beda
        // ==========================================

        const { createClient } = supabase;
        let supabaseClient = null;
        let isUploading = false;

        // Elements
        const fileInput = document.getElementById('file-input');
        const dropZone = document.getElementById('drop-zone');
        const viewUpload = document.getElementById('view-upload');
        const viewProgress = document.getElementById('view-progress');
        const viewResult = document.getElementById('view-result');
        const progressBar = document.getElementById('progress-bar');
        const progressPercent = document.getElementById('progress-percent');
        const resultLink = document.getElementById('result-link');
        const fileNameEl = document.getElementById('file-name');
        const fileSizeEl = document.getElementById('file-size');

        // Check config
        window.addEventListener('DOMContentLoaded', () => {
            if (!SUPABASE_URL || !SUPABASE_KEY) {
                document.getElementById('config-warning').classList.remove('hidden');
                fileInput.disabled = true;
                dropZone.style.cursor = 'not-allowed';
            } else {
                supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);
            }
        });

        // Drag & Drop
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => dropZone.addEventListener(e, preventDefaults));
        function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }

        dropZone.addEventListener('dragover', () => dropZone.classList.add('dragover'));
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', e => {
            dropZone.classList.remove('dragover');
            if (e.dataTransfer.files.length) handleFiles(e.dataTransfer.files[0]);
        });

        fileInput.addEventListener('change', e => {
            if (e.target.files.length) handleFiles(e.target.files[0]);
        });

        async function handleFiles(file) {
            if (isUploading) return;
            if (!supabaseClient) return showToast('Config Supabase belum lengkap', 'error');

            if (file.size > 50 * 1024 * 1024) {
                return showToast('File terlalu besar (max 50MB)', 'error');
            }

            isUploading = true;
            dropZone.classList.add('uploading');

            updateView('progress');
            fileNameEl.textContent = file.name;
            fileSizeEl.textContent = formatBytes(file.size);
            updateProgressUI(0);

            const fileExt = file.name.includes('.') ? file.name.split('.').pop().toLowerCase() : 'file';
            const uniqueName = `${crypto.randomUUID()}.${fileExt}`;

            let progressInterval;
            try {
                // Fake smooth progress
                let fakeProg = 0;
                progressInterval = setInterval(() => {
                    if (fakeProg >= 92) {
                        fakeProg += (100 - fakeProg) * 0.12;
                    } else {
                        fakeProg += 2.5 + Math.random() * 7;
                    }
                    fakeProg = Math.min(fakeProg, 92);
                    updateProgressUI(fakeProg);
                }, 160);

                const { data, error } = await supabaseClient.storage
                    .from(BUCKET_NAME)
                    .upload(uniqueName, file, {
                        cacheControl: '3600',
                        upsert: false
                    });

                clearInterval(progressInterval);

                if (error) throw error;

                updateProgressUI(100);

                const { data: urlData } = supabaseClient.storage
                    .from(BUCKET_NAME)
                    .getPublicUrl(uniqueName);

                setTimeout(() => {
                    resultLink.value = urlData.publicUrl;
                    updateView('result');
                    showToast('Upload berhasil!', 'success');
                }, 600);

            } catch (err) {
                console.error('Upload failed:', err);
                clearInterval(progressInterval);

                let msg = 'Gagal upload... coba lagi ya';
                if (err.message?.includes('size') || err.message?.includes('limit')) msg = 'Ukuran file melebihi batas bucket';
                else if (err.message?.includes('permission') || err.message?.includes('key')) msg = 'Masalah akses Supabase (cek config)';
                else if (err.message) msg = err.message;

                showToast(msg, 'error');
                setTimeout(() => updateView('upload'), 2600);
            } finally {
                isUploading = false;
                dropZone.classList.remove('uploading');
            }
        }

        // Helpers
        function updateView(view) {
            [viewUpload, viewProgress, viewResult].forEach(v => v.classList.add('hidden'));
            if (view === 'upload') viewUpload.classList.remove('hidden');
            if (view === 'progress') viewProgress.classList.remove('hidden');
            if (view === 'result') viewResult.classList.remove('hidden');
        }

        function updateProgressUI(val) {
            const percent = Math.round(val);
            progressBar.style.width = percent + '%';
            progressPercent.textContent = percent + '%';
        }

        function formatBytes(bytes, decimals = 1) {
            if (!+bytes) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
        }

        function copyToClipboard() {
            resultLink.select();
            document.execCommand('copy');
            showToast('Link sudah dicopy!', 'success');
        }

        function resetApp() {
            fileInput.value = '';
            updateProgressUI(0);
            updateView('upload');
        }

        function showToast(msg, type = 'info') {
            const toast = document.getElementById('toast');
            const msgEl = document.getElementById('toast-msg');
            const icon = document.getElementById('toast-icon');

            msgEl.textContent = msg;
            icon.className = type === 'error' 
                ? 'fas fa-exclamation-circle text-red-400 text-xl' 
                : 'fas fa-check-circle text-green-400 text-xl';

            toast.classList.remove('-translate-y-24', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-100');

            setTimeout(() => {
                toast.classList.remove('translate-y-0', 'opacity-100');
                toast.classList.add('-translate-y-24', 'opacity-0');
            }, 3200);
        }
    </script>
</body>
</html>
